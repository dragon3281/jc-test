# ğŸš€ é¡¹ç›®å¯åŠ¨æŒ‡å—

## å½“å‰çŠ¶æ€

âœ… Dockerå·²å®‰è£…å¹¶å¯åŠ¨
ğŸ”„ Docker Composeæ­£åœ¨åå°æ‹‰å–é•œåƒå¹¶å¯åŠ¨æœåŠ¡

## æ£€æŸ¥DockeræœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹Docker Composeæ—¥å¿—
tail -f /tmp/docker-compose.log

# æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨
docker ps

# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
cd /root/jc-test/docker && docker compose ps
```

## ç¯å¢ƒä¸æœåŠ¡æ¸…å•

### ç¯å¢ƒè¦æ±‚
- æ“ä½œç³»ç»Ÿ: Ubuntu 22.04 LTSï¼ˆæ¨èï¼ŒGLIBC 2.35ï¼‰æˆ– CentOS 9ï¼ˆGLIBC 2.28+ï¼‰
- JDK: 17+
- Maven: 3.6+
- Node.js: 18 LTS
- Docker + Docker Compose
- Playwright: 1.45.0ï¼ˆéœ€è¦å®‰è£… Chromium åŠç³»ç»Ÿä¾èµ–ï¼‰

### æœåŠ¡ä¸ç«¯å£
- åç«¯æœåŠ¡: http://localhost:8080/api ï¼ˆç›®å½•: /root/jc-test/backendï¼‰
- å‰ç«¯æœåŠ¡: http://localhost:3000 ï¼ˆç›®å½•: /root/jc-test/frontendï¼‰
- MySQL: 3306 ï¼ˆå®¹å™¨: detection-mysqlï¼‰
- Redis: 6379 ï¼ˆå®¹å™¨: detection-redisï¼‰
- RabbitMQ: 5672 / ç®¡ç† 15672 ï¼ˆå®¹å™¨: detection-rabbitmqï¼‰
- WebSocket: åç«¯ /ws/ è·¯å¾„ï¼ˆç» Nginx ä»£ç†éœ€æ”¯æŒ Upgrade/Connection å¤´ï¼‰

### å…³é”®ç›®å½•
- docker/docker-compose.yml ï¼ˆåŸºç¡€æœåŠ¡ç¼–æ’ï¼‰
- backend/src/main/resources/application.yml ï¼ˆåç«¯é…ç½®ï¼‰
- sql/init.sql, sql/upgrade-executor-and-draft.sql ï¼ˆæ•°æ®åº“è„šæœ¬ï¼‰
- frontend/src/utils/websocket.js ï¼ˆå‰ç«¯ WebSocket å®¢æˆ·ç«¯ï¼‰

### å¿«é€Ÿè¿è¡Œæ€»è§ˆ
1. å¯åŠ¨åŸºç¡€æœåŠ¡: `cd docker && docker compose up -d`
2. åˆå§‹åŒ–æ•°æ®åº“: `docker exec -i detection-mysql mysql -uroot -p123456 detection_platform < /root/jc-test/sql/init.sql`
3. å®‰è£…æµè§ˆå™¨ä¾èµ–ä¸é©±åŠ¨ï¼ˆUbuntu ç¤ºä¾‹ï¼‰:
   - `sudo apt install -y libnss3 libnspr4 libatk1.0-0 libatk-bridge2.0-0 libcups2 libdrm2 libxkbcommon0 libxcomposite1 libxdamage1 libxfixes3 libxrandr2 libgbm1 libasound2 libpangocairo-1.0-0 libgtk-3-0`
   - `cd backend && mvn exec:java -Dexec.mainClass=com.microsoft.playwright.CLI -Dexec.args="install chromium"`
4. å¯åŠ¨åç«¯: `cd backend && mvn spring-boot:run`
5. å¯åŠ¨å‰ç«¯: `cd frontend && npm install && npm run dev`
6. è®¿é—®ç³»ç»Ÿ: å‰ç«¯ `http://localhost:3000`ï¼Œåç«¯ API `http://localhost:8080/api`

## å®Œæ•´å¯åŠ¨æ­¥éª¤

### 1. ç­‰å¾…åŸºç¡€æœåŠ¡å¯åŠ¨å®Œæˆï¼ˆçº¦5-10åˆ†é’Ÿï¼‰

```bash
# æ£€æŸ¥MySQLæ˜¯å¦å°±ç»ª
docker logs detection-mysql 2>&1 | grep "ready for connections"

# æ£€æŸ¥Redisæ˜¯å¦å°±ç»ª
docker logs detection-redis 2>&1 | grep "Ready to accept connections"

# æ£€æŸ¥RabbitMQæ˜¯å¦å°±ç»ª
docker logs detection-rabbitmq 2>&1 | grep "Server startup complete"
```

### 2. åˆå§‹åŒ–æ•°æ®åº“

```bash
# ç­‰å¾…MySQLå®Œå…¨å¯åŠ¨åæ‰§è¡Œ
sleep 30

# å¯¼å…¥æ•°æ®åº“
docker exec -i detection-mysql mysql -uroot -p123456 detection_platform < /root/jc-test/sql/init.sql

# éªŒè¯æ•°æ®åº“è¡¨
docker exec -it detection-mysql mysql -uroot -p123456 -e "USE detection_platform; SHOW TABLES;"
```

### 3. å®‰è£…Javaå’ŒMaven

**ç”±äºCentOS 7æ²¡æœ‰JDK 17çš„å®˜æ–¹åŒ…ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£…ï¼š**

```bash
# ä¸‹è½½JDK 17ï¼ˆä½¿ç”¨åä¸ºé•œåƒï¼‰
cd /opt
wget https://repo.huaweicloud.com/java/jdk/17+35/jdk-17_linux-x64_bin.tar.gz

# è§£å‹
tar -xzf jdk-17_linux-x64_bin.tar.gz
mv jdk-17 /usr/local/

# é…ç½®ç¯å¢ƒå˜é‡
cat >> /etc/profile << 'JAVA_EOF'
export JAVA_HOME=/usr/local/jdk-17
export PATH=$JAVA_HOME/bin:$PATH
JAVA_EOF

source /etc/profile

# éªŒè¯
java -version
```

**å®‰è£…Mavenï¼š**

```bash
cd /opt
wget https://mirrors.tuna.tsinghua.edu.cn/apache/maven/maven-3/3.9.5/binaries/apache-maven-3.9.5-bin.tar.gz
tar -xzf apache-maven-3.9.5-bin.tar.gz

# é…ç½®ç¯å¢ƒå˜é‡
cat >> /etc/profile << 'MAVEN_EOF'
export MAVEN_HOME=/opt/apache-maven-3.9.5
export PATH=$MAVEN_HOME/bin:$PATH
MAVEN_EOF

source /etc/profile

# é…ç½®å›½å†…é•œåƒ
mkdir -p ~/.m2
cat > ~/.m2/settings.xml << 'SETTINGS_EOF'
<?xml version="1.0" encoding="UTF-8"?>
<settings xmlns="http://maven.apache.org/SETTINGS/1.0.0"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.0.0 
          http://maven.apache.org/xsd/settings-1.0.0.xsd">
  <mirrors>
    <mirror>
      <id>aliyun</id>
      <mirrorOf>central</mirrorOf>
      <name>Aliyun Maven</name>
      <url>https://maven.aliyun.com/repository/public</url>
    </mirror>
  </mirrors>
</settings>
SETTINGS_EOF

# éªŒè¯
mvn -version
```

### 4. å®‰è£…Node.js

```bash
# ä½¿ç”¨NodeSourceä»“åº“
curl -sL https://rpm.nodesource.com/setup_18.x | bash -
yum install -y nodejs

# é…ç½®npmå›½å†…é•œåƒ
npm config set registry https://registry.npmmirror.com

# éªŒè¯
node -v
npm -v
```

### 5. å¯åŠ¨åç«¯æœåŠ¡

```bash
cd /root/jc-test/backend

# ç¼–è¯‘å¹¶å¯åŠ¨
mvn clean install -DskipTests
mvn spring-boot:run

# æˆ–è€…æ‰“åŒ…åå¯åŠ¨
mvn clean package -DskipTests
nohup java -jar target/detection-platform-1.0.0.jar > /tmp/backend.log 2>&1 &
```

### 6. å¯åŠ¨å‰ç«¯æœåŠ¡

```bash
cd /root/jc-test/frontend

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# æˆ–åå°è¿è¡Œ
nohup npm run dev > /tmp/frontend.log 2>&1 &
```

### 7. è®¿é—®ç³»ç»Ÿ

- **å‰ç«¯åœ°å€**: http://localhost:3000
- **åç«¯API**: http://localhost:8080/api
- **RabbitMQç®¡ç†ç•Œé¢**: http://localhost:15672 (admin/admin)

**é»˜è®¤è´¦å·**:
- ç”¨æˆ·å: admin
- å¯†ç : admin123

## æ•…éšœæ’æŸ¥

### DockeræœåŠ¡æœªå¯åŠ¨

```bash
docker ps
# å¦‚æœå¤±è´¥ï¼Œé‡æ–°å¯åŠ¨ï¼š
cd /root/jc-test/docker
docker compose up -d
```

### MySQLè¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥MySQLçŠ¶æ€
docker logs detection-mysql

# é‡å¯MySQL
docker restart detection-mysql
```

### åç«¯å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹æ—¥å¿—
tail -f /root/jc-test/logs/detection-platform.log

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
docker exec -it detection-mysql mysql -uroot -p123456 -e "SELECT 1"
```

## æµ‹è¯•API

```bash
cd /root/jc-test
./test-api.sh
```

## æŸ¥çœ‹å®Œæ•´æ–‡æ¡£

- README.md
- æ–‡æ¡£å¯¼èˆª.md
- æ³¨å†Œæµç¨‹åŠ è§£å¯†å®Œæ•´æ–¹æ¡ˆ.md
- é¡¹ç›®éƒ¨ç½²çŠ¶æ€.md

