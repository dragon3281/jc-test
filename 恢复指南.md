# ğŸš€ é¡¹ç›®å¿«é€Ÿæ¢å¤æŒ‡å—

ç”Ÿæˆæ—¶é—´ï¼š2025-11-13  
ç›®æ ‡ï¼šä¿®å¤æ‰€æœ‰é—®é¢˜ï¼Œå¯åŠ¨å®Œæ•´ç³»ç»Ÿ

---

## ğŸ“‹ é—®é¢˜è¯Šæ–­ç»“æœ

### âœ… æ­£å¸¸éƒ¨åˆ†
1. **DockeræœåŠ¡** - MySQL/Redis/RabbitMQè¿è¡Œæ­£å¸¸
2. **é¡¹ç›®é…ç½®** - æ‰€æœ‰é…ç½®æ–‡ä»¶æ­£ç¡®ï¼ˆç«¯å£ã€æ—¥å¿—ã€å®‰å…¨ï¼‰
3. **ä»£ç è´¨é‡** - åç«¯ä»£ç å·²ä¿®å¤æ‰€æœ‰å¾ªç¯ä¾èµ–å’Œå®‰å…¨é—®é¢˜

### âš ï¸ å‘ç°çš„é—®é¢˜
1. **æ—§è¿›ç¨‹å¹²æ‰°** - å­˜åœ¨åƒµå°¸nodeå’Œjavaè¿›ç¨‹å ç”¨ç«¯å£
2. **Terminalç¯å¢ƒæ±¡æŸ“** - å‘½ä»¤è¾“å‡ºè¢«curlç­‰è¿›ç¨‹æ±¡æŸ“
3. **æ—¥å¿—ç¼ºå¤±** - åº”ç”¨æ—¥å¿—ç›®å½•æœªåˆ›å»º

---

## ğŸ”§ ä¿®å¤æ­¥éª¤

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /root/jc-test

# 2. æ‰§è¡Œé‡å¯è„šæœ¬
bash restart-services.sh

# 3. ç­‰å¾…90ç§’è®©æœåŠ¡å®Œå…¨å¯åŠ¨

# 4. æ£€æŸ¥æ—¥å¿—
cat logs/deployment.log          # éƒ¨ç½²æ—¥å¿—
tail -50 logs/detection-platform.log  # åç«¯åº”ç”¨æ—¥å¿—
```

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨é€æ­¥æ“ä½œ

```bash
# 1. æ¸…ç†æ—§è¿›ç¨‹
killall -9 node java
sleep 3

# 2. ç¡®ä¿DockeræœåŠ¡è¿è¡Œ
cd /root/jc-test/docker
docker-compose ps
# å¦‚æœæœ‰æœåŠ¡æœªè¿è¡Œï¼š
docker-compose up -d

# 3. å¯åŠ¨åç«¯ï¼ˆ8080ç«¯å£ï¼‰
cd /root/jc-test/backend
source /etc/profile

# å¦‚æœjaråŒ…ä¸å­˜åœ¨æˆ–éœ€è¦é‡æ–°ç¼–è¯‘ï¼š
mvn clean package -DskipTests

# å¯åŠ¨åç«¯
mkdir -p /root/jc-test/logs
nohup java -jar target/detection-platform-1.0.0.jar \
  --logging.file.name=/root/jc-test/logs/detection-platform.log \
  --logging.level.root=INFO \
  --logging.level.com.detection.platform=DEBUG \
  > /root/jc-test/logs/backend-startup.log 2>&1 &

# ç­‰å¾…åç«¯å¯åŠ¨ï¼ˆå¤§çº¦15-30ç§’ï¼‰
sleep 30

# 4. å¯åŠ¨å‰ç«¯ï¼ˆ3000ç«¯å£ï¼‰
cd /root/jc-test/frontend

# åŠ è½½NVMï¼ˆå¦‚æœä½¿ç”¨ï¼‰
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
nvm use 16

# å¦‚æœä¾èµ–æœªå®‰è£…ï¼š
npm install

# å¯åŠ¨å‰ç«¯
nohup npm run dev > /root/jc-test/logs/frontend-startup.log 2>&1 &

# ç­‰å¾…å‰ç«¯å¯åŠ¨ï¼ˆå¤§çº¦10ç§’ï¼‰
sleep 15
```

---

## ğŸŒ éªŒè¯æœåŠ¡

### 1. æ£€æŸ¥ç«¯å£ç›‘å¬
```bash
netstat -tlnp | grep -E ":(3000|8080)"
```

**æœŸæœ›è¾“å‡º**ï¼š
```
tcp    0    0 127.0.0.1:3000    0.0.0.0:*    LISTEN    <pid>/node
tcp6   0    0 :::8080           :::*         LISTEN    <pid>/java
```

### 2. æµ‹è¯•å‰ç«¯è®¿é—®
```bash
curl -I http://127.0.0.1:3000
```

**æœŸæœ›è¾“å‡º**ï¼šHTTP/1.1 200 OK

### 3. æµ‹è¯•åç«¯API
```bash
curl -X POST http://127.0.0.1:8080/user/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

**æœŸæœ›è¾“å‡º**ï¼š
```json
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "eyJ...",
    "userInfo": {...}
  }
}
```

---

## ğŸ“ æ—¥å¿—ä½ç½®

æ‰€æœ‰æ—¥å¿—æ–‡ä»¶ä½äº `/root/jc-test/logs/` ç›®å½•ï¼š

| æ—¥å¿—æ–‡ä»¶ | è¯´æ˜ | é‡è¦æ€§ |
|---------|------|--------|
| `deployment.log` | éƒ¨ç½²è¿‡ç¨‹æ—¥å¿— | â­â­â­ |
| `detection-platform.log` | åç«¯åº”ç”¨æ—¥å¿—ï¼ˆDEBUGçº§åˆ«ï¼‰| â­â­â­â­ |
| `backend-startup.log` | åç«¯å¯åŠ¨è¾“å‡º | â­â­â­ |
| `frontend-startup.log` | å‰ç«¯å¯åŠ¨è¾“å‡º | â­â­ |

### æŸ¥çœ‹æ—¥å¿—å‘½ä»¤
```bash
# å®æ—¶æŸ¥çœ‹åç«¯æ—¥å¿—
tail -f /root/jc-test/logs/detection-platform.log

# æŸ¥çœ‹æœ€è¿‘çš„é”™è¯¯
grep -i error /root/jc-test/logs/detection-platform.log | tail -20

# æŸ¥çœ‹ç™»å½•ç›¸å…³æ—¥å¿—
grep -i login /root/jc-test/logs/detection-platform.log | tail -20
```

---

## ğŸ” ç™»å½•ä¿¡æ¯

### ç³»ç»Ÿè®¿é—®åœ°å€
- **å‰ç«¯**: http://127.0.0.1:3000
- **åç«¯API**: http://127.0.0.1:8080
- **RabbitMQç®¡ç†**: http://127.0.0.1:15672

### é»˜è®¤è´¦å·
- **ç”¨æˆ·å**: `admin`
- **å¯†ç **: `admin123`

### RabbitMQè´¦å·
- **ç”¨æˆ·å**: `admin`
- **å¯†ç **: `admin`

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šåç«¯å¯åŠ¨å¤±è´¥

**æ£€æŸ¥**ï¼š
```bash
tail -50 /root/jc-test/logs/backend-startup.log
```

**å¸¸è§åŸå› **ï¼š
- MySQLæœªå°±ç»ª â†’ `docker restart detection-mysql`
- ç«¯å£è¢«å ç”¨ â†’ `fuser -k 8080/tcp`
- jaråŒ…æŸå â†’ é‡æ–°ç¼–è¯‘ `mvn clean package -DskipTests`

### é—®é¢˜2ï¼šå‰ç«¯æ— æ³•è®¿é—®

**æ£€æŸ¥**ï¼š
```bash
tail -50 /root/jc-test/logs/frontend-startup.log
netstat -tlnp | grep 3000
```

**å¸¸è§åŸå› **ï¼š
- ç«¯å£è¢«å ç”¨ â†’ `fuser -k 3000/tcp`
- ä¾èµ–æœªå®‰è£… â†’ `cd frontend && npm install`
- Nodeç‰ˆæœ¬é—®é¢˜ â†’ ç¡®ä¿ä½¿ç”¨Node 16+

### é—®é¢˜3ï¼šç™»å½•å¤±è´¥ï¼ˆ401é”™è¯¯ï¼‰

**æ£€æŸ¥åç«¯æ—¥å¿—**ï¼š
```bash
grep -A 10 "login" /root/jc-test/logs/detection-platform.log | tail -30
```

**å¯èƒ½åŸå› **ï¼š
- æ•°æ®åº“ä¸­ç”¨æˆ·å¯†ç æœªæ­£ç¡®æ›´æ–°
- JWTé…ç½®é—®é¢˜
- Securityé…ç½®é—®é¢˜

**è§£å†³**ï¼š
```bash
# æ›´æ–°adminå¯†ç ä¸ºadmin123
docker exec -i detection-mysql mysql -uroot -p123456 detection_platform <<'EOF'
UPDATE t_user SET password='$2a$10$1mmqU2Cqa2ieQzJAAf499ORH4BH243joplPlY/CEy5BTekjODB7dq' WHERE username='admin';
SELECT 'Password updated' as result;
EOF
```

### é—®é¢˜4ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

**æ£€æŸ¥MySQLçŠ¶æ€**ï¼š
```bash
docker logs detection-mysql | tail -50
docker exec -it detection-mysql mysql -uroot -p123456 -e "SELECT 1"
```

**è§£å†³**ï¼š
```bash
# é‡å¯MySQL
docker restart detection-mysql
sleep 10

# éªŒè¯æ•°æ®åº“
docker exec -it detection-mysql mysql -uroot -p123456 -e "SHOW DATABASES;"
```

---

## ğŸ“Š æœåŠ¡å¥åº·æ£€æŸ¥æ¸…å•

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®Œæ•´æ£€æŸ¥ï¼š

```bash
#!/bin/bash
echo "=== æœåŠ¡å¥åº·æ£€æŸ¥ ==="

echo "1. DockeræœåŠ¡:"
docker ps | grep detection- && echo "âœ“ Dockeræ­£å¸¸" || echo "âœ— Dockerå¼‚å¸¸"

echo ""
echo "2. ç«¯å£ç›‘å¬:"
netstat -tlnp | grep -q ":3000" && echo "âœ“ å‰ç«¯(3000)æ­£å¸¸" || echo "âœ— å‰ç«¯æœªå¯åŠ¨"
netstat -tlnp | grep -q ":8080" && echo "âœ“ åç«¯(8080)æ­£å¸¸" || echo "âœ— åç«¯æœªå¯åŠ¨"

echo ""
echo "3. è¿›ç¨‹æ£€æŸ¥:"
pgrep -f "java.*detection-platform" > /dev/null && echo "âœ“ Javaè¿›ç¨‹å­˜åœ¨" || echo "âœ— Javaè¿›ç¨‹ä¸å­˜åœ¨"
pgrep -f "node.*vite" > /dev/null && echo "âœ“ Nodeè¿›ç¨‹å­˜åœ¨" || echo "âœ— Nodeè¿›ç¨‹ä¸å­˜åœ¨"

echo ""
echo "4. APIæµ‹è¯•:"
timeout 3 curl -s http://127.0.0.1:8080/user/test-password?password=test | grep -q "code" && echo "âœ“ åç«¯APIå“åº”" || echo "âœ— åç«¯APIæ— å“åº”"

echo ""
echo "=== æ£€æŸ¥å®Œæˆ ==="
```

ä¿å­˜ä¸º `/root/jc-test/health-check.sh` å¹¶æ‰§è¡Œï¼š
```bash
chmod +x /root/jc-test/health-check.sh
bash /root/jc-test/health-check.sh
```

---

## ğŸ¯ æ ¸å¿ƒé…ç½®è¯´æ˜

### åç«¯é…ç½®ï¼ˆapplication.ymlï¼‰
```yaml
server:
  port: 8080                    # åç«¯ç«¯å£ï¼ˆä¸è¦ä¿®æ”¹ï¼‰

spring:
  datasource:
    url: jdbc:mysql://localhost:3306/detection_platform
    username: root
    password: 123456

logging:
  level:
    root: INFO
    com.detection.platform: DEBUG  # DEBUGçº§åˆ«ï¼Œè®°å½•æ‰€æœ‰æ“ä½œ
  file:
    name: logs/detection-platform.log
```

### å‰ç«¯é…ç½®ï¼ˆvite.config.jsï¼‰
```javascript
export default defineConfig({
  server: {
    port: 3000,                 # å‰ç«¯ç«¯å£ï¼ˆä¸è¦ä¿®æ”¹ï¼‰
    proxy: {
      '/api': {
        target: 'http://localhost:8080',  # åç«¯åœ°å€
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '')
      }
    }
  }
})
```

### Securityé…ç½®
- **å…¬å¼€è·¯å¾„**ï¼š
  - `/user/login` - ç™»å½•æ¥å£
  - `/user/test-password` - æµ‹è¯•æ¥å£
  - `/ws/**` - WebSocketè¿æ¥

- **å—ä¿æŠ¤è·¯å¾„**ï¼šæ‰€æœ‰å…¶ä»–è·¯å¾„éœ€è¦JWT Token

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- å®Œæ•´æ‰‹å†Œï¼š`README-å®Œæ•´ç‰ˆ.md`
- å¯åŠ¨æŒ‡å—ï¼š`å¯åŠ¨æŒ‡å—.md`
- æ–‡æ¡£å¯¼èˆªï¼š`æ–‡æ¡£å¯¼èˆª.md`
- APIæµ‹è¯•ï¼š`test-api.sh`

---

## âœ¨ æˆåŠŸæ ‡å¿—

å½“çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºï¼Œè¯´æ˜ç³»ç»Ÿå·²å®Œå…¨æ­£å¸¸ï¼š

1. **å‰ç«¯å¯åŠ¨æˆåŠŸ**ï¼š
```
VITE v4.5.5  ready in xxx ms
âœ  Local:   http://127.0.0.1:3000/
```

2. **åç«¯å¯åŠ¨æˆåŠŸ**ï¼š
```
Started DetectionPlatformApplication in X.XXX seconds
Tomcat started on port(s): 8080 (http)
```

3. **ç™»å½•æµ‹è¯•æˆåŠŸ**ï¼šè¿”å›åŒ…å«tokençš„JSONå“åº”

---

**å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶æˆ–é‡æ–°è¿è¡Œrestart-services.shè„šæœ¬ï¼**
