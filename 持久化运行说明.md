# è‡ªåŠ¨åŒ–æ•°æ®æ£€æµ‹å¹³å° - æŒä¹…åŒ–è¿è¡Œè¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•è®©å‰åç«¯æœåŠ¡æŒä¹…åŒ–è¿è¡Œ,é¿å…é¢‘ç¹æ‰çº¿çš„é—®é¢˜ã€‚

## âœ… å·²å®æ–½çš„ä¼˜åŒ–

### 1. WebSocketå¿ƒè·³ä¿æ´»æœºåˆ¶

**åç«¯é…ç½® (`application.yml`)**:
```yaml
server:
  tomcat:
    connection-timeout: 60000      # è¿æ¥è¶…æ—¶60ç§’
    keep-alive-timeout: 60000      # Keep-Aliveè¶…æ—¶60ç§’
    max-keep-alive-requests: 100   # æœ€å¤§Keep-Aliveè¯·æ±‚æ•°
```

**WebSocketé…ç½® (`WebSocketConfig.java`)**:
```java
registry.enableSimpleBroker("/topic", "/queue")
        .setHeartbeatValue(new long[] {10000, 10000});  // å¿ƒè·³é—´éš”10ç§’
```

**å‰ç«¯WebSocketå®¢æˆ·ç«¯ (`websocket.js`)**:
- âœ… è‡ªåŠ¨å¿ƒè·³æ£€æµ‹(20ç§’é—´éš”)
- âœ… æ–­çº¿è‡ªåŠ¨é‡è¿(3ç§’å»¶è¿Ÿ)
- âœ… è¿æ¥çŠ¶æ€ç›‘æ§

### 2. è¿›ç¨‹æŒä¹…åŒ–è¿è¡Œ

æä¾›äº†ä¸¤ç§è¿è¡Œæ–¹å¼:

#### æ–¹å¼ä¸€: systemdæœåŠ¡(æ¨è,æ”¯æŒå¼€æœºè‡ªå¯)

**ç‰¹ç‚¹**:
- âœ… å¼‚å¸¸è‡ªåŠ¨é‡å¯
- âœ… å¼€æœºè‡ªåŠ¨å¯åŠ¨  
- âœ… ç³»ç»Ÿçº§è¿›ç¨‹ç®¡ç†
- âœ… æ—¥å¿—è‡ªåŠ¨ç®¡ç†

**ä½¿ç”¨æ–¹æ³•**:
```bash
# å¯åŠ¨æœåŠ¡
bash /root/jc-test/persistent-start.sh systemd

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
systemctl status detection-backend
systemctl status detection-frontend

# æŸ¥çœ‹æ—¥å¿—
journalctl -u detection-backend -f
journalctl -u detection-frontend -f

# åœæ­¢æœåŠ¡
systemctl stop detection-backend detection-frontend

# é‡å¯æœåŠ¡
systemctl restart detection-backend detection-frontend
```

#### æ–¹å¼äºŒ: nohupåå°è¿è¡Œ(å½“å‰ä½¿ç”¨)

**ç‰¹ç‚¹**:
- âœ… åå°æŒç»­è¿è¡Œ
- âœ… ä¸ä¾èµ–SSHä¼šè¯
- âœ… æ—¥å¿—æ–‡ä»¶è®°å½•
- âš ï¸ éœ€æ‰‹åŠ¨è®¾ç½®å¼€æœºå¯åŠ¨

**ä½¿ç”¨æ–¹æ³•**:
```bash
# å¯åŠ¨æœåŠ¡
bash /root/jc-test/persistent-start.sh nohup

# æŸ¥çœ‹æ—¥å¿—
tail -f /root/jc-test/logs/backend-startup.log
tail -f /root/jc-test/logs/frontend-startup.log
tail -f /root/jc-test/logs/detection-platform.log

# åœæ­¢æœåŠ¡
bash /root/jc-test/stop-services.sh

# æˆ–æ‰‹åŠ¨åœæ­¢
kill $(cat /root/jc-test/logs/backend.pid)
kill $(cat /root/jc-test/logs/frontend.pid)
```

### 3. å¥åº·ç›‘æ§è„šæœ¬

**åŠŸèƒ½**:
- âœ… æ£€æŸ¥DockeræœåŠ¡çŠ¶æ€
- âœ… æ£€æŸ¥å‰åç«¯æœåŠ¡çŠ¶æ€
- âœ… æ£€æŸ¥WebSocketè¿æ¥
- âœ… ç›‘æ§ç³»ç»Ÿèµ„æº
- âœ… æ£€æŸ¥æ—¥å¿—æ–‡ä»¶å¤§å°

**ä½¿ç”¨æ–¹æ³•**:
```bash
bash /root/jc-test/health-check.sh
```

**è®¾ç½®å®šæ—¶æ£€æŸ¥(å¯é€‰)**:
```bash
# ç¼–è¾‘crontab
crontab -e

# æ·»åŠ ä»¥ä¸‹è¡Œ,æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
*/5 * * * * /bin/bash /root/jc-test/health-check.sh >> /root/jc-test/logs/health-check.log 2>&1
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å½“å‰æœåŠ¡çŠ¶æ€

```
âœ… åç«¯æœåŠ¡: è¿è¡Œä¸­ (PID: 169883, ç«¯å£: 8080)
âœ… å‰ç«¯æœåŠ¡: è¿è¡Œä¸­ (PID: 169889, ç«¯å£: 3000)
âœ… WebSocket: å¯ç”¨ (ws://localhost:8080/ws)
```

### è®¿é—®åœ°å€

- **å‰ç«¯**: http://103.246.246.4:3000
- **åç«¯**: http://103.246.246.4:8080
- **é»˜è®¤è´¦å·**: admin / admin123

## ğŸ“ å¸¸ç”¨å‘½ä»¤

### æœåŠ¡ç®¡ç†

```bash
# å¯åŠ¨æœåŠ¡(nohupæ–¹å¼)
bash /root/jc-test/persistent-start.sh nohup

# å¯åŠ¨æœåŠ¡(systemdæ–¹å¼)
bash /root/jc-test/persistent-start.sh systemd

# åœæ­¢æœåŠ¡
bash /root/jc-test/stop-services.sh

# å¥åº·æ£€æŸ¥
bash /root/jc-test/health-check.sh
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# å®æ—¶æŸ¥çœ‹åç«¯å¯åŠ¨æ—¥å¿—
tail -f /root/jc-test/logs/backend-startup.log

# å®æ—¶æŸ¥çœ‹å‰ç«¯å¯åŠ¨æ—¥å¿—
tail -f /root/jc-test/logs/frontend-startup.log

# å®æ—¶æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f /root/jc-test/logs/detection-platform.log

# æŸ¥çœ‹æœ€è¿‘50è¡Œæ—¥å¿—
tail -50 /root/jc-test/logs/detection-platform.log
```

### è¿›ç¨‹æŸ¥çœ‹

```bash
# æŸ¥çœ‹åç«¯è¿›ç¨‹
ps aux | grep "detection-platform-1.0.0.jar"

# æŸ¥çœ‹å‰ç«¯è¿›ç¨‹
ps aux | grep "vite.*3000"

# æŸ¥çœ‹ç«¯å£ç›‘å¬
netstat -tlnp | grep -E ":(3000|8080)"
```

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜1: å‰ç«¯æ— æ³•è®¿é—®

**æ£€æŸ¥æ­¥éª¤**:
```bash
# 1. æ£€æŸ¥å‰ç«¯è¿›ç¨‹æ˜¯å¦è¿è¡Œ
ps aux | grep vite

# 2. æ£€æŸ¥3000ç«¯å£æ˜¯å¦ç›‘å¬
netstat -tlnp | grep 3000

# 3. æŸ¥çœ‹å‰ç«¯æ—¥å¿—
tail -50 /root/jc-test/logs/frontend-startup.log

# 4. é‡å¯å‰ç«¯
bash /root/jc-test/stop-services.sh
bash /root/jc-test/persistent-start.sh nohup
```

### é—®é¢˜2: åç«¯APIæ— å“åº”

**æ£€æŸ¥æ­¥éª¤**:
```bash
# 1. æ£€æŸ¥åç«¯è¿›ç¨‹
ps aux | grep detection-platform

# 2. æ£€æŸ¥8080ç«¯å£
netstat -tlnp | grep 8080

# 3. æµ‹è¯•API
curl -X POST http://localhost:8080/user/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'

# 4. æŸ¥çœ‹åç«¯æ—¥å¿—
tail -100 /root/jc-test/logs/detection-platform.log
```

### é—®é¢˜3: WebSocketé¢‘ç¹æ–­å¼€

**å¯èƒ½åŸå› **:
1. ç½‘ç»œä¸ç¨³å®š
2. é˜²ç«å¢™é™åˆ¶
3. åå‘ä»£ç†è¶…æ—¶è®¾ç½®è¿‡çŸ­

**è§£å†³æ–¹æ¡ˆ**:
- âœ… å·²é…ç½®å¿ƒè·³æœºåˆ¶(10ç§’æœåŠ¡ç«¯,20ç§’å®¢æˆ·ç«¯)
- âœ… å·²é…ç½®è‡ªåŠ¨é‡è¿(3ç§’å»¶è¿Ÿ)
- âœ… å·²é…ç½®Keep-Alive(60ç§’è¶…æ—¶)

**æ£€æŸ¥å‘½ä»¤**:
```bash
# æ£€æŸ¥WebSocketç«¯ç‚¹
curl -i http://localhost:8080/ws

# å®æ—¶ç›‘æ§WebSocketæ—¥å¿—
tail -f /root/jc-test/logs/detection-platform.log | grep -i websocket
```

### é—®é¢˜4: æœåŠ¡å™¨é‡å¯åæœåŠ¡æœªè‡ªåŠ¨å¯åŠ¨

**ä½¿ç”¨systemdæœåŠ¡(æ¨è)**:
```bash
# å®‰è£…systemdæœåŠ¡
bash /root/jc-test/persistent-start.sh systemd

# éªŒè¯å¼€æœºè‡ªå¯
systemctl is-enabled detection-backend
systemctl is-enabled detection-frontend
```

**æˆ–æ·»åŠ rc.localå¼€æœºå¯åŠ¨**:
```bash
# ç¼–è¾‘rc.local
sudo nano /etc/rc.local

# æ·»åŠ ä»¥ä¸‹å†…å®¹
#!/bin/bash
/bin/bash /root/jc-test/persistent-start.sh nohup >> /root/jc-test/logs/startup.log 2>&1
exit 0

# æ·»åŠ æ‰§è¡Œæƒé™
sudo chmod +x /etc/rc.local
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### å·²ä¼˜åŒ–é¡¹

1. **è¿æ¥æ± é…ç½®**:
   - Tomcatæœ€å¤§è¿æ¥: 200
   - HikariCPè¿æ¥æ± : 10-50
   - Redisè¿æ¥æ± : 10-50
   - HTTPè¿æ¥æ± : 500

2. **JVMå‚æ•°**:
   - åˆå§‹å †å†…å­˜: 512MB
   - æœ€å¤§å †å†…å­˜: 2048MB
   - GCç®—æ³•: G1GC
   - GCæš‚åœç›®æ ‡: 200ms

3. **è¶…æ—¶é…ç½®**:
   - è¿æ¥è¶…æ—¶: 60ç§’
   - Keep-Alive: 60ç§’
   - WebSocketå¿ƒè·³: 10ç§’

## ğŸ›¡ï¸ å®‰å…¨å»ºè®®

1. **ä¿®æ”¹é»˜è®¤å¯†ç **: 
   - ç™»å½•åè¯·ç«‹å³ä¿®æ”¹adminå¯†ç 

2. **é˜²ç«å¢™é…ç½®**:
   ```bash
   # ä»…å…è®¸å¿…è¦ç«¯å£è®¿é—®
   ufw allow 3000/tcp  # å‰ç«¯
   ufw allow 8080/tcp  # åç«¯
   ```

3. **å®šæœŸå¤‡ä»½**:
   ```bash
   # å¤‡ä»½æ•°æ®åº“
   docker exec detection-mysql mysqldump -u root -p123456 detection_platform > backup.sql
   
   # å¤‡ä»½æ—¥å¿—
   tar -czf logs-backup-$(date +%Y%m%d).tar.gz /root/jc-test/logs/
   ```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡é—®é¢˜,è¯·æ”¶é›†ä»¥ä¸‹ä¿¡æ¯:

```bash
# ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š
{
    echo "=== ç³»ç»Ÿä¿¡æ¯ ==="
    uname -a
    echo ""
    echo "=== è¿›ç¨‹çŠ¶æ€ ==="
    ps aux | grep -E "java|node|vite"
    echo ""
    echo "=== ç«¯å£ç›‘å¬ ==="
    netstat -tlnp
    echo ""
    echo "=== æœ€è¿‘æ—¥å¿— ==="
    tail -50 /root/jc-test/logs/detection-platform.log
} > /root/jc-test/diagnostic-report.txt

cat /root/jc-test/diagnostic-report.txt
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¿«é€Ÿéƒ¨ç½²æŒ‡å—](docs/å¿«é€Ÿéƒ¨ç½²æŒ‡å—.md)
- [å¼€å‘æŒ‡å—](docs/å¼€å‘æŒ‡å—.md)
- [é¡¹ç›®äº¤ä»˜æ€»ç»“](docs/é¡¹ç›®äº¤ä»˜æ€»ç»“.md)

---

**æœ€åæ›´æ–°**: 2025-12-09  
**ç‰ˆæœ¬**: 1.0.0
